%% createColorImage (RGB) from colormap and indexed image
% 
% Andreas Husch
% Centre Hospitalier de Luxembourg, Dept. of Neurosurgery /
% University of Luxembourg - Luxembourg Centre for Systems Biomedicine
% 2009 - 2017
% mail@andreashusch.de, husch.andreas@chl.lu
function image = createColorImage(rawImageData, myColormap, lowerLimit, upperLimit) 
    %cmHumidity = [1,0.600000023841858,0;1,0.623529434204102,0.00267379684373736;1,0.647058844566345,0.00534759368747473;1,0.670588254928589,0.00802139099687338;1,0.694117665290833,0.0106951873749495;1,0.717647075653076,0.0133689846843481;1,0.741176486015320,0.0160427819937468;1,0.764705896377564,0.0187165774405003;1,0.788235306739807,0.0213903747498989;1,0.811764717102051,0.0240641720592976;1,0.835294127464294,0.0267379693686962;1,0.858823537826538,0.0294117648154497;1,0.882352948188782,0.0320855639874935;1,0.905882358551025,0.0347593575716019;1,0.929411768913269,0.0374331548810005;1,0.952941179275513,0.0401069521903992;1,0.976470589637756,0.0427807494997978;1,1,0.0454545468091965;0.990909099578857,0.990909099578857,0.0888429731130600;0.981818199157715,0.981818199157715,0.132231399416924;0.972727298736572,0.972727298736572,0.175619840621948;0.963636338710785,0.963636338710785,0.219008266925812;0.954545438289642,0.954545438289642,0.262396693229675;0.945454537868500,0.945454537868500,0.305785119533539;0.936363637447357,0.936363637447357,0.349173545837402;0.927272737026215,0.927272737026215,0.392561972141266;0.918181836605072,0.918181836605072,0.435950428247452;0.909090936183929,0.909090936183929,0.479338854551315;0.899999976158142,0.899999976158142,0.522727251052856;0.890909075737000,0.890909075737000,0.566115677356720;0.881818175315857,0.881818175315857,0.609504103660584;0.872727274894714,0.872727274894714,0.652892589569092;0.863636374473572,0.863636374473572,0.696281015872955;0.854545474052429,0.854545474052429,0.739669442176819;0.845454573631287,0.845454573631287,0.783057868480682;0.836363673210144,0.836363673210144,0.826446294784546;0.827272713184357,0.827272713184357,0.869834721088409;0.818181812763214,0.818181812763214,0.913223147392273;0.809090912342072,0.809090912342072,0.956611573696137;0.800000011920929,0.800000011920929,1;0.766666650772095,0.766666650772095,1;0.733333349227905,0.733333349227905,1;0.699999988079071,0.699999988079071,1;0.666666686534882,0.666666686534882,1;0.633333325386047,0.633333325386047,1;0.600000023841858,0.600000023841858,1;0.566666662693024,0.566666662693024,1;0.533333361148834,0.533333361148834,1;0.500000000000000,0.500000000000000,1;0.466666668653488,0.466666668653488,1;0.433333337306976,0.433333337306976,1;0.400000005960465,0.400000005960465,1;0.366666674613953,0.366666674613953,1;0.333333343267441,0.333333343267441,1;0.300000011920929,0.300000011920929,1;0.266666680574417,0.266666680574417,1;0.233333334326744,0.233333334326744,1;0.200000002980232,0.200000002980232,1;0.166666671633720,0.166666671633720,1;0.133333340287209,0.133333340287209,1;0.100000001490116,0.100000001490116,1;0.0666666701436043,0.0666666701436043,1;0.0333333350718021,0.0333333350718021,1;0,0,1;];   
    rawImageData(isnan(rawImageData)) = 0;
    colorIndices = round(...
                           max(...% prevent 0 results
                                min((double(rawImageData) - double(lowerLimit)) ./ double(upperLimit - lowerLimit),...
                                     1) ...
                                   .* length(myColormap),...
                              1));
                    
   % myColormap = flipud(myColormap);
    imageVector = myColormap(colorIndices,:,:);
    image = reshape(imageVector, [size(rawImageData) 3]);
end